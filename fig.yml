#
# Zookeeper
#
zookeeper:
  image: samsara/zookeeper
  ports:
    - "2181:2181"
    - "15001:15000"
  environment:
    ZK_SERVER_ID: 1
  volumes:
    - /tmp/logs/zk1:/logs
    - /tmp/data/zk1:/data

#
# Kafka
#
kafka:
  image: samsara/kafka
  ports:
    - "9092:9092"
    - "15002:15000"
  links:
    - zookeeper:zookeeper
  environment:
    KAFKA_BROKER_ID: 1
  volumes:
    - /tmp/logs/kafka1:/logs
    - /tmp/data/kafka1:/data

#
# Samsara Ingestion API
#
ingestion:
  image: samsara/ingestion-api
  links:
    - kafka:kafka
  ports:
    - "9000:9000"
    - "15000:15000"
  volumes:
    - /tmp/logs/ingestion-api:/logs

#
# ElasticSearch
#
elasticsearch:
  image: samsara/elasticsearch
  links:
    - zookeeper:zookeeper
  ports:
    - "9200:9200"
    - "9300:9300"
  volumes:
    - /tmp/logs/els:/logs
    - /tmp/data/els:/data

#
# Samsara Qanal
#
qanal:
    image: samsara/qanal
    links:
      - zookeeper:zookeeper
      - elasticsearch:els
    environment:
      KAFKA_TOPIC: events
      KAFKA_PARTITION_ID: 1
    volumes:
      - /tmp/logs/qanal1:/logs


#
# Monitoring: InfluxDB
#
influxdb:
  image: tutum/influxdb
  ports:
    - "8083:8083"
    - "8086:8086"
  environment:
    PRE_CREATE_DB: samsara

#
# Monitoring: Riemann
#
riemann:
  image: samsara/riemann
  ports:
    - "5555:5555"
  links:
    - influxdb:influxdb

#
# Monitoring: Grafana
#
grafana:
  image: tutum/grafana
  ports:
    - "8080:80"
  environment:
    HTTP_USER: admin
    HTTP_PASS: samsara
    INFLUXDB_PROTO: http
    INFLUXDB_HOST: localhost
    INFLUXDB_PORT: 8086
    INFLUXDB_NAME: samsara
    INFLUXDB_USER: root
    INFLUXDB_PASS: root
    INFLUXDB_IS_GRAFANADB: "true"
